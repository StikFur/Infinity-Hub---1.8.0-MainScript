-------------------------------------------------
-- Infinity Hub 1.7.7
-------------------------------------------------
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local Player = Players.LocalPlayer

-- Groups you want to show titles for
local groups = {
    [5345749]    = {"Chosen One Enthusiasts Club", Color3.fromRGB(0,255,0)},
    [35956339]   = {"Clementiuilo", Color3.fromRGB(108,77,59)},
    [33203248]   = {"Roblox's Rejects", Color3.fromRGB(177,125,82)},
    [35155850]   = {"Unchainable Mercy", Color3.fromRGB(108,77,59)},
    [35985581]   = {"Genesis", Color3.fromRGB(82,138,174)},
    [33258647]   = {"Union of Mirrland Communist States", Color3.fromRGB(120,0,0)},
    [34915496]   = {"dauens silly", Color3.fromRGB(0,120,0)},
    [34348476]   = {"Frigid's silly fan club", Color3.fromRGB(0,0,200)},
    [34838919]   = {"The Eternal Flame of TCO", Color3.fromRGB(255,255,0)},
    [35986983]   = {"Realm ???", Color3.fromRGB(42,73,199)},
    [286855251]  = {"| The Mafia |", Color3.fromRGB(139,0,0)}
}


-------------------------------------------------
-- Clean OLD GUI
-------------------------------------------------
pcall(function()
    Player.PlayerGui:FindFirstChild("Infinity Hub"):Destroy()
end)

-------------------------------------------------
-- SCREEN GUI
-------------------------------------------------
local Gui = Instance.new("ScreenGui")
Gui.Name = "Infinity Hub"
Gui.ResetOnSpawn = false
Gui.Parent = Player:WaitForChild("PlayerGui")

-------------------------------------------------
-- STATE
-------------------------------------------------
local Hidden = true
local startTime = tick()
local executionCount = 0

-------------------------------------------------
-- MAIN WINDOW
-------------------------------------------------
local Main = Instance.new("Frame")
Main.Size = UDim2.new(0, 620, 0, 360)
Main.Position = UDim2.new(0.5, -310, 0.5, -180)
Main.BackgroundColor3 = Color3.fromRGB(16, 16, 20)
Main.BorderSizePixel = 0
Main.Active = true
Main.Draggable = true
Main.Parent = Gui
Main.Visible = false
Instance.new("UICorner", Main).CornerRadius = UDim.new(0, 10)

-------------------------------------------------
-- TOP BAR
-------------------------------------------------
local Top = Instance.new("Frame")
Top.Size = UDim2.new(1, 0, 0, 42)
Top.BackgroundColor3 = Color3.fromRGB(20, 20, 26)
Top.BorderSizePixel = 0
Top.Parent = Main

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, -80, 1, 0)
Title.Position = UDim2.new(0, 10, 0, 0)
Title.BackgroundTransparency = 1
Title.Text = "Welcome, To Infinity Hub!"
Title.Font = Enum.Font.GothamBold
Title.TextSize = 14
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.TextColor3 = Color3.fromRGB(185, 145, 255)
Title.Parent = Top

-------------------------------------------------
-- SHOW HUB BUTTON
-------------------------------------------------
local ShowButton = Instance.new("TextButton")
ShowButton.Size = UDim2.new(0, 150, 0, 35)
ShowButton.Position = UDim2.new(0.5, -75, 0, 10)
ShowButton.AnchorPoint = Vector2.new(0.5, 0)
ShowButton.BackgroundColor3 = Color3.fromRGB(26, 26, 34)
ShowButton.TextColor3 = Color3.fromRGB(190, 150, 255)
ShowButton.Font = Enum.Font.GothamBold
ShowButton.TextSize = 14
ShowButton.Text = "IH"
ShowButton.Parent = Gui
ShowButton.Visible = true
Instance.new("UICorner", ShowButton).CornerRadius = UDim.new(0, 6)

local glowShow = Instance.new("UIStroke", ShowButton)
glowShow.Color = Color3.fromRGB(170, 120, 255)
glowShow.Transparency = 0.7

ShowButton.MouseEnter:Connect(function() glowShow.Transparency = 0 end)
ShowButton.MouseLeave:Connect(function() glowShow.Transparency = 0.7 end)
ShowButton.MouseButton1Click:Connect(function()
    Main.Visible = true
    Hidden = false
    ShowButton.Visible = false
end)

-------------------------------------------------
-- DRAG FUNCTION
-------------------------------------------------
local function MakeDraggable(gui)
    local dragging, dragInput, dragStart, startPos

    gui.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = gui.Position

            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    gui.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            dragInput = input
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            gui.Position = UDim2.new(
                startPos.X.Scale,
                startPos.X.Offset + delta.X,
                startPos.Y.Scale,
                startPos.Y.Offset + delta.Y
            )
        end
    end)
end

-------------------------------------------------
-- DRAGGABLE SHOWBUTTON
-------------------------------------------------
MakeDraggable(ShowButton)

-------------------------------------------------
-- FUNCTION TO CREATE TOP BUTTONS
-------------------------------------------------
local function CreateTopButton(parent, text, offsetX, callback)
    local b = Instance.new("TextButton")
    b.Size = UDim2.new(0, 30, 0, 30)
    b.Position = UDim2.new(1, -offsetX - 10, 0, 6)
    b.Text = text
    b.Font = Enum.Font.GothamBold
    b.TextSize = 18
    b.TextColor3 = Color3.fromRGB(220, 150, 255)
    b.BackgroundColor3 = Color3.fromRGB(26, 26, 34)
    b.BorderSizePixel = 0
    b.Parent = parent
    Instance.new("UICorner", b).CornerRadius = UDim.new(0, 6)

    local glow = Instance.new("UIStroke", b)
    glow.Color = Color3.fromRGB(170, 120, 255)
    glow.Transparency = 0.7

    b.MouseEnter:Connect(function() glow.Transparency = 0 end)
    b.MouseLeave:Connect(function() glow.Transparency = 0.7 end)
    b.MouseButton1Click:Connect(callback)
end

-------------------------------------------------
-- CLOSE AND HIDE BUTTONS
-------------------------------------------------
CreateTopButton(Top, "X", 10, function() Gui:Destroy() end)
CreateTopButton(Top, "‚Äì", 50, function()
    Main.Visible = false
    Hidden = true
    ShowButton.Visible = true
end)

-------------------------------------------------
-- SIDEBAR
-------------------------------------------------
local Side = Instance.new("Frame")
Side.Position = UDim2.new(0, 0, 0, 42)
Side.Size = UDim2.new(0, 70, 1, -42)
Side.BackgroundColor3 = Color3.fromRGB(18, 18, 22)
Side.BorderSizePixel = 0
Side.Parent = Main

-------------------------------------------------
-- PAGES
-------------------------------------------------
local Pages = {}
local CurrentPage

local function NewPage(name)
    local p = Instance.new("Frame")
    p.Name = name
    p.Size = UDim2.new(1, 0, 1, 0)
    p.Position = UDim2.new(0, 0, 0, 0)
    p.BackgroundTransparency = 1
    p.Visible = false
    p.Parent = Main

-------------------------------------------------
-- SCROLLABLE FRAME INSIDE PAGE
-------------------------------------------------
    local scroll = Instance.new("ScrollingFrame")
    scroll.Size = UDim2.new(1, -90, 1, -70)
    scroll.Position = UDim2.new(0, 90, 0, 60)
    scroll.BackgroundTransparency = 1
    scroll.ScrollBarThickness = 6
    scroll.CanvasSize = UDim2.new(0, 0, 0, 0)
    scroll.VerticalScrollBarInset = Enum.ScrollBarInset.ScrollBar
    scroll.Parent = p
    scroll.Name = name .. "_Scroll"

    Pages[name] = {Page = p, Scroll = scroll}
    return Pages[name]
end

local Info = NewPage("Info")
local Scripts = NewPage("Scripts")
local Settings = NewPage("Settings")
local Others = NewPage("Others")
Info.Page.Visible = true
CurrentPage = Info

-------------------------------------------------
-- ICON TAB CREATOR
-------------------------------------------------
local function IconTab(icon, pageTable, y)
    local b = Instance.new("TextButton")
    b.Size = UDim2.new(0, 46, 0, 40)
    b.Position = UDim2.new(0, 12, 0, y)
    b.Text = icon
    b.Font = Enum.Font.GothamBold
    b.TextSize = 18
    b.TextColor3 = Color3.fromRGB(190, 150, 255)
    b.BackgroundColor3 = Color3.fromRGB(26, 26, 34)
    b.BorderSizePixel = 0
    b.Parent = Side
    Instance.new("UICorner", b).CornerRadius = UDim.new(0, 8)

    local glow = Instance.new("UIStroke", b)
    glow.Color = Color3.fromRGB(170, 120, 255)
    glow.Transparency = 1

    b.MouseEnter:Connect(function()
        TweenService:Create(glow, TweenInfo.new(0.2), {Transparency = 0}):Play()
    end)
    b.MouseLeave:Connect(function()
        TweenService:Create(glow, TweenInfo.new(0.2), {Transparency = 1}):Play()
    end)

    b.MouseButton1Click:Connect(function()
        if CurrentPage then
            CurrentPage.Page.Visible = false
        end
        pageTable.Page.Visible = true
        CurrentPage = pageTable
    end)
end

-------------------------------------------------
-- TABS
-------------------------------------------------
IconTab("‚Ñπ", Info, 20)
IconTab("üìú", Scripts, 70)
IconTab("‚öô", Settings, 120)
IconTab("‚≠ê", Others, 170)

-------------------------------------------------
-- SECTION FUNCTION
-------------------------------------------------
local function Section(scrollParent, y, title, text)
    local f = Instance.new("Frame")
    f.Size = UDim2.new(1, 0, 0, 90)
    f.Position = UDim2.new(0, 0, 0, y)
    f.BackgroundColor3 = Color3.fromRGB(22, 22, 28)
    f.BorderSizePixel = 0
    Instance.new("UICorner", f).CornerRadius = UDim.new(0, 8)
    f.Parent = scrollParent

    local t = Instance.new("TextLabel", f)
    t.Size = UDim2.new(1, -20, 0, 24)
    t.Position = UDim2.new(0, 10, 0, 6)
    t.BackgroundTransparency = 1
    t.Text = title
    t.Font = Enum.Font.GothamBold
    t.TextSize = 13
    t.TextXAlignment = Enum.TextXAlignment.Left
    t.TextColor3 = Color3.fromRGB(195, 155, 255)

    local d = Instance.new("TextLabel", f)
    d.Size = UDim2.new(1, -20, 0, 50)
    d.Position = UDim2.new(0, 10, 0, 32)
    d.BackgroundTransparency = 1
    d.TextWrapped = true
    d.TextYAlignment = Enum.TextYAlignment.Top
    d.TextXAlignment = Enum.TextXAlignment.Left
    d.Font = Enum.Font.Gotham
    d.TextSize = 13
    d.TextColor3 = Color3.fromRGB(225, 225, 225)
    d.Text = text

    scrollParent.CanvasSize = UDim2.new(0, 0, 0, y + 100)
    return d
end

-------------------------------------------------
-- BUTTON FUNCTION
-------------------------------------------------
local function AddButton(scrollParent, y, text, callback)
    local b = Instance.new("TextButton")
    b.Size = UDim2.new(0, 200, 0, 40)
    b.Position = UDim2.new(0, 10, 0, y)
    b.BackgroundColor3 = Color3.fromRGB(70, 40, 120)
    b.TextColor3 = Color3.fromRGB(255, 255, 255)
    b.Font = Enum.Font.GothamBold
    b.TextSize = 14
    b.Text = text
    b.BorderSizePixel = 0
    Instance.new("UICorner", b).CornerRadius = UDim.new(0, 8)
    b.Parent = scrollParent

    local glow = Instance.new("UIStroke", b)
    glow.Color = Color3.fromRGB(190, 120, 255)
    glow.Transparency = 0.7

    b.MouseEnter:Connect(function() glow.Transparency = 0 end)
    b.MouseLeave:Connect(function() glow.Transparency = 0.7 end)
    b.MouseButton1Click:Connect(function()
        if callback then callback() end
    end)

    scrollParent.CanvasSize = UDim2.new(0, 0, 0, y + 50)
end

-------------------------------------------------
-- INFO TAB
-------------------------------------------------
local infoLabel = Section(Info.Scroll, 0, "Information", "")
Section(Info.Scroll, 100, "Credits", "Developer: Stik\nYou are whitelisted, nice!")
Section(Info.Scroll, 200, "Version", "v1.7.6")
AddButton(Info.Scroll, 280, "Thanks for using the Hub ;3", function() print("Thank ya!") end)

spawn(function()
    while true do
        task.wait(1)
        local elapsed = tick() - startTime
        local hrs = math.floor(elapsed / 3600)
        local mins = math.floor((elapsed % 3600) / 60)
        local secs = math.floor(elapsed % 60)
        infoLabel.Text = string.format("Method: Lua Script\nExecution Count: %d\nElapsed Time: %02d:%02d:%02d", executionCount, hrs, mins, secs)
    end
end)

-------------------------------------------------
-- SCRIPT TAB
-------------------------------------------------
Section(Scripts.Scroll, 0, "Available Scripts", "Here you can execute available scripts.")
local spacing = 10
local startY = 100
local buttonHeight = 40

local scriptsList = {
    {"- Translator -", function() loadstring(game:HttpGet("https://raw.githubusercontent.com/StikFur/translator/refs/heads/main/Translator"))() executionCount = executionCount + 1 print("- Translator executed!") end},
    {"- Ported IY -", function() loadstring(game:HttpGet("https://pandadevelopment.net/virtual/file/2eabce36586bcc7d"))() executionCount = executionCount + 1 print("- Ported IY executed!") end},
    {"- VPLI Hub -", function() loadstring(game:HttpGet("https://raw.githubusercontent.com/Adam3mka/The-chosen-one-lukaku/refs/heads/main/Protected_6361979247750901.txt"))() executionCount = executionCount + 1 print("- VPLI Hub executed!") end},
    {"- Matrix Hub -", function() loadstring(game:HttpGet('https://raw.githubusercontent.com/StikFur/MatrixHUB/refs/heads/main/Stik'))() executionCount = executionCount + 1 print("- Matrix Hub executed!") end},
    {"- Extra Stuff -", function() loadstring(game:HttpGet("https://pastebin.com/raw/sqadnExa"))() executionCount = executionCount + 1 print("- Extra Stuff executed!") end},
    {"- XVC Hub -", function() loadstring(game:HttpGet("https://luna.xvchubontop.workers.dev/"))() executionCount = executionCount + 1 print("- XVC Hub executed!") end},
    {"- Brick UA -", function() loadstring(game:HttpGet("https://pastebin.com/raw/ZwCXk9mb"))() executionCount = executionCount + 1 print("- Brick UA executed!") end},
    {"- Chat Spammer -", function() loadstring(game:HttpGet('https://raw.githubusercontent.com/k1llm3sixy/chat-spammer/refs/heads/main/chat_spammer.lua'))() executionCount = executionCount + 1 print("- Spammer executed!") end},
}

for i, v in ipairs(scriptsList) do
    AddButton(Scripts.Scroll, startY + (i-1)*(buttonHeight + spacing), v[1], v[2])
end

-------------------------------------------------
-- SETTING TAB
-------------------------------------------------
Section(Settings.Scroll, 0, "Controls", "Drag window anywhere\nUse left icons to switch tabs")
AddButton(Settings.Scroll, 100, "Settings", function() 
    PlayClickSound()
    print("You are on settings!") 
end)

-- Rejoin Server Button
AddButton(Settings.Scroll, 160, "Rejoin Server", function()
    local TeleportService = game:GetService("TeleportService")
    local Player = game.Players.LocalPlayer
    local PlaceId = game.PlaceId

    -- Queue your hub script before teleport
    if queue_on_teleport then
        queue_on_teleport([[loadstring(game:HttpGet("https://raw.githubusercontent.com/StikFur/Infinity-Hub---1.7.6-MainScript/refs/heads/main/St!kHub"))()]])
    elseif syn and syn.queue_on_teleport then
        syn.queue_on_teleport([[loadstring(game:HttpGet("https://raw.githubusercontent.com/StikFur/Infinity-Hub---1.7.6-MainScript/refs/heads/main/St!kHub"))()]])
    end

    -- Teleport
    TeleportService:Teleport(PlaceId, Player)
end)

-- Hop Server Button
AddButton(Settings.Scroll, 220, "Hop Server", function()
    local HttpService = game:GetService("HttpService")
    local TeleportService = game:GetService("TeleportService")
    local Player = game.Players.LocalPlayer
    local PlaceId = game.PlaceId

    -- Queue hub script for next server
    if queue_on_teleport then
        queue_on_teleport([[loadstring(game:HttpGet("https://raw.githubusercontent.com/StikFur/Infinity-Hub---1.7.6-MainScript/refs/heads/main/St!kHub"))()]])
    elseif syn and syn.queue_on_teleport then
        syn.queue_on_teleport([[loadstring(game:HttpGet("https://raw.githubusercontent.com/StikFur/Infinity-Hub---1.7.6-MainScript/refs/heads/main/St!kHub"))()]])
    end

    -- Fetch available servers
    local success, servers = pcall(function()
        return HttpService:JSONDecode(game:HttpGet("https://games.roblox.com/v1/games/"..PlaceId.."/servers/Public?sortOrder=Asc&limit=100"))
    end)

    if success and servers and servers.data then
        for i,v in pairs(servers.data) do
            if v.id ~= game.JobId and v.playing < v.maxPlayers then
                TeleportService:TeleportToPlaceInstance(PlaceId, v.id, Player)
                break
            end
        end
    end
end)

-------------------------------------------------
-- OTHERS TAB
-------------------------------------------------
Section(Others.Scroll, 0, "Miscellaneous", "Extra features can go here")
AddButton(Others.Scroll, 100, "Do Something", function() print("Button Clicked!!") end)

-------------------------------------------------
-- GROUP TITLES SYSTEM
-------------------------------------------------
local groupTitles = {}
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Camera = workspace.CurrentCamera
local Player = Players.LocalPlayer

local function getGroupInfo(plr)
    for groupId, data in pairs(groups) do
        local success, role = pcall(function() return plr:GetRoleInGroup(groupId) end)
        if success and role and plr:IsInGroup(groupId) then
            return {Name = data[1], Color = data[2], Rank = role}
        end
    end
    return nil
end

local function isVisible(targetCharacter, plr)
    if plr == Player then return true end
    if not targetCharacter or not targetCharacter:FindFirstChild("Head") then return false end
    local head = targetCharacter.Head
    local origin = Camera.CFrame.Position
    local direction = head.Position - origin

    local rayParams = RaycastParams.new()
    rayParams.FilterType = Enum.RaycastFilterType.Blacklist
    rayParams.FilterDescendantsInstances = {Player.Character or workspace}

    local result = workspace:Raycast(origin, direction, rayParams)
    if result and result.Instance then
        return result.Instance:IsDescendantOf(targetCharacter)
    end
    return false
end

local function createOrUpdateBillboard(plr)
    task.spawn(function()
        local character = plr.Character or plr.CharacterAdded:Wait()
        local head = character:WaitForChild("Head", 5)
        if not head then return end

        local info = getGroupInfo(plr)
        if not info then return end

        -- Remove old GUI if it exists
        local oldGui = head:FindFirstChild("GroupTitle")
        if oldGui then oldGui:Destroy() end

        -- Create Billboard
        local gui = Instance.new("BillboardGui")
        gui.Name = "GroupTitle"
        gui.Adornee = head
        gui.Size = UDim2.new(0, 400, 0, 120)
        gui.AlwaysOnTop = false
        gui.Parent = head

        -- Calculate offset above the name tag
        local defaultOffsetY = 3.5 -- normal
        local extraOffset = 0.6    -- extra space to not overlap
        gui.StudsOffset = Vector3.new(0, defaultOffsetY + extraOffset, 0)

        -- Group Name Label
        local nameLabel = Instance.new("TextLabel")
        nameLabel.Size = UDim2.new(1,0,0.6,0)
        nameLabel.Position = UDim2.new(0,0,0,0)
        nameLabel.BackgroundTransparency = 1
        nameLabel.Font = Enum.Font.GothamBold
        nameLabel.TextSize = 36
        nameLabel.Text = info.Name
        nameLabel.TextColor3 = info.Color
        nameLabel.TextStrokeTransparency = 0
        nameLabel.Parent = gui

        -- Rank Label
        local rankLabel = Instance.new("TextLabel")
        rankLabel.Size = UDim2.new(1,0,0.4,0)
        rankLabel.Position = UDim2.new(0,0,0.6,4)
        rankLabel.BackgroundTransparency = 1
        rankLabel.Font = Enum.Font.GothamSemibold
        rankLabel.TextSize = 28
        rankLabel.Text = info.Rank
        rankLabel.TextColor3 = info.Color
        rankLabel.TextStrokeTransparency = 0
        rankLabel.Parent = gui

        -- Store reference
        groupTitles[plr] = gui

        -- Hide if player not visible through walls
        RunService.RenderStepped:Connect(function()
            if gui and gui.Parent then
                gui.Enabled = isVisible(character, plr)
            end
        end)
    end)
end

local function connectPlayer(plr)
    createOrUpdateBillboard(plr)
    plr.CharacterAdded:Connect(function()
        createOrUpdateBillboard(plr)
    end)
end

-- Remove old billboards
for _, plr in pairs(Players:GetPlayers()) do
    if plr.Character then
        local head = plr.Character:FindFirstChild("Head")
        if head then
            local oldGui = head:FindFirstChild("GroupTitle")
            if oldGui then oldGui:Destroy() end
        end
    end
end

-- Connect all players
for _, plr in pairs(Players:GetPlayers()) do
    connectPlayer(plr)
end
Players.PlayerAdded:Connect(connectPlayer)

print("‚úÖ Infinity Hub | fully loaded (1.7.7)!")
